# sudo nginx -t && sudo nginx -s reload && sudo systemctl status nginx --no-pager -l

user www-data;
worker_processes 8; # auto;
worker_rlimit_nofile 65535; # 32768; # worker_processes √ó worker_connections
pid /run/nginx.pid; # Process üÜî
error_log /var/log/nginx/error.log; # ‚ùå –£–∫–∞–∑–∞–Ω–∏–µ error_log –≥–ª–æ–±–∞–ª—å–Ω–æ (–≤–Ω–µ –±–ª–æ–∫–∞ http) –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –æ—à–∏–±–∫–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –∑–∞–ø—É—Å–∫–æ–º –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π —Å–∞–º–æ–≥–æ Nginx, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤.
include /etc/nginx/modules-enabled/*.conf;

events {
  worker_connections 4096;
  use epoll;
  multi_accept on; # üâë
}

http {

  # ‚öôÔ∏è  Main settings
  #
  include /etc/nginx/block.map.include;
  sendfile                        on;
  tcp_nopush                      on;
  tcp_nodelay                     on;
  #client_header_timeout           2m;
  #client_body_timeout             2m;
  client_header_buffer_size       4k;
  client_body_buffer_size         256k;
  client_max_body_size            256m;
  large_client_header_buffers     4 16k;
  proxy_buffers                   8 16k;
  #send_timeout                    30;
  #keepalive_timeout               60 60;
  reset_timedout_connection       on;
  # server_tokens                   off;
  server_name_in_redirect         off;
  server_names_hash_max_size      512;
  server_names_hash_bucket_size   512;
  client_header_timeout           10s;
  client_body_timeout             10s;
  send_timeout                    10s;
  keepalive_timeout               30s;
  variables_hash_max_size         2048; # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ö—ç—à-—Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.
  variables_hash_bucket_size      128;  # –†–∞–∑–º–µ—Ä –æ–¥–Ω–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞ (bucket) —Ö—ç—à-—Ç–∞–±–ª–∏—Ü—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.

  # üìö Logging
  #
  log_format main '$remote_addr - $remote_user [$time_local] $host "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" "$http_x_forwarded_for" $request_time $upstream_response_time $pipe $server_name';
  # log_format main '$remote_addr - $remote_user [$time_local] $host $request "$status" $body_bytes_sent "$http_referer" "$http_user_agent" "$http_x_forwarded_for"';
  log_format ip_and_uri '$remote_addr - $request_uri'; # log_format ip_only '$remote_addr';
  log_format bytes '$body_bytes_sent';
  access_log /var/log/nginx/access.log; # –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç error_log, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫, access_log –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –æ–± HTTP-–∑–∞–ø—Ä–æ—Å–∞—Ö, —Ç–∞–∫–∏—Ö –∫–∞–∫ —É—Å–ø–µ—à–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –∏–ª–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

  # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞—Ä—Ç—É (map) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ 404
  map $status $is_404 {
    default 0;
    404 1;
  }

  # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞—Ä—Ç—É (map) –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –ø—É—Ç–µ–π –∏–∑ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
  map $request_uri $log_404_path {
    default 1;
    "/comment" 0;
    "~*\.(jpg|jpeg|png|gif|css|js|ico)$" 0;
  }

  # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞—Ä—Ç—É (map) –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ø–æ User-Agent –∏–∑ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
  map $http_user_agent $log_404_ua {
    default 1; # –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç –Ω–∏ –æ–¥–Ω–æ –∏–∑ —É—Å–ª–æ–≤–∏–π –Ω–∏–∂–µ
    "~*(curl|murl)" 0; # –ò—Å–∫–ª—é—á–∞–µ–º –±–æ—Ç–æ–≤ –ø–æ User-Agent
  }

  # –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ —É—Å–ª–æ–≤–∏—è –≤ –æ–¥–Ω—É –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é: $is_404, $log_404_path, $log_404_ua. –ü–æ—Ä—è–¥–æ–∫ –≤–∞–∂–µ–Ω! –°–Ω–∞—á–∞–ª–∞ –∏–¥–µ—Ç —Å—Ç–∞—Ç—É—Å, –ø–æ—Ç–æ–º –ø—É—Ç—å, –ø–æ—Ç–æ–º User-Agent.
  map "$is_404$log_404_path$log_404_ua" $log_404 {
    default 0;
    "111" 1;
  }

  log_format detailed_404 '[$time_local]\n'
                          '  remote_addr: $remote_addr\n'
                          '  remote_port: $remote_port\n'
                          '  remote_user: $remote_user\n'
                          '  server_name: $server_name\n'
                          '  server_port: $server_port\n'
                          '  server_protocol: $server_protocol\n'
                          '  host: $host\n'
                          '  uri: $uri\n'
                          '  request: $request\n'
                          '  scheme: $scheme\n'
                          '  http_referer: $http_referer\n'
                          '  status: $status\n'
                          '  body_bytes_sent: $body_bytes_sent\n'
                          '  http_user_agent: $http_user_agent\n'
                          '  http_x_forwarded_for: $http_x_forwarded_for\n'
                          '  request_time: $request_time\n'
                          '  pipe: $pipe\n'
                          '  upstream_response_time: $upstream_response_time\n'
                          '  upstream_addr: $upstream_addr\n';

  log_format ncsa_goaccess '$remote_addr - [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent"'; # NCSA Combined Log Format
  # sudo bash -c "echo 'log-format %h %^[%d:%t %^] \"%r\" %s %b \"%R\" \"%u\"' >> /etc/goaccess/goaccess.conf"
  # sudo bash -c "echo 'date-format %d/%b/%Y' >> /etc/goaccess/goaccess.conf"
  # sudo bash -c "echo 'time-format %H:%M:%S' >> /etc/goaccess/goaccess.conf"

  # üåà Content Types
  #
  include /etc/nginx/mime.types;
  default_type application/octet-stream;

  # üîê SSL Settings
  #
  ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE
  ssl_prefer_server_ciphers on;

  # ü§ñ Phusion Passenger
  # 
  # Use also:
  # - `sudo passenger-status` for common info
  # - `sudo passenger-memory-stats` for checking for memory leaks
  # - `watch -n 10 "passenger-memory-stats | grep AppPreloader"`
  # - `watch -n 5 "passenger-status | grep -E 'PID|Memory'"`
  #
  passenger_dump_config_manifest /tmp/passenger-config-manifest.json; # cat /tmp/passenger-config-manifest.json | jq .
  passenger_max_pool_size 8;
  passenger_pre_start https://rozarioflowers.ru/;
  passenger_pre_start https://entropyrise.ru/;
  # passenger_show_version_in_header off;
  passenger_friendly_error_pages on;
  passenger_disable_anonymous_telemetry on; # fuck off!
  passenger_data_buffer_dir /tmp;
  passenger_headers_hash_max_size 512;
  passenger_buffer_size 8k;
  passenger_buffers 8 8k;
  passenger_busy_buffers_size 16k;
  passenger_response_buffer_high_watermark 268435456; # 256 MiB
  passenger_buffer_response off;
  passenger_spawn_method smart; # or `direct` # https://www.phusionpassenger.com/library/indepth/ruby/spawn_methods/#smart-spawning-hooks
  # passenger_concurrency_model process; # process (by default) | thread | hybrid (experimental) # Only for Phusion Passenger Enterprise üí∞
  # passenger_thread_count 4; # Only for Phusion Passenger Enterprise üí∞
  passenger_max_request_queue_size 200; # http://stackoverflow.com/questions/20402801/what-is-optimal-value-for-phusion-passenger-passengermaxrequestqueuesize
  # passenger_max_request_queue_time 0; # Only for Phusion Passenger Enterprise üí∞
  passenger_request_queue_overflow_status_code 529; # By default: 503. 529 ‚Äî –Ω–µ–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∫–æ–¥ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –¥–ª—è "Server Is Overloaded" (–ø–æ —Å–æ–≥–ª–∞—à–µ–Ω–∏—é Cloudflare, Fastly). –ù–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å –¥—Ä—É–≥–∏–º–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ –∫–æ–¥–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 503 –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –¥–ª—è maintenance mode, 429 –¥–ª—è rate limiting). –û—á–µ–≤–∏–¥–µ–Ω –≤ –ª–æ–≥–∞—Ö: HTTP 529 ‚Üí "Passenger Queue Overflow".
  passenger_pool_idle_time 1020;
  # passenger_force_max_concurrent_requests_per_process 0; # `-1` by default (euristic), but for SSE or WS use `0`: https://www.phusionpassenger.com/library/config/nginx/tuning_sse_and_websockets/
  passenger_turbocaching on;
    
  passenger_log_file /var/log/nginx/passenger.log; # üìù # TD: https://www.phusionpassenger.com/library/admin/nginx/log_rotation.html # Also: https://www.phusionpassenger.com/library/indepth/std_channels.html
  passenger_log_level 5;
  # passenger_debugger on; # Only for Phusion Passenger Enterprise üí∞
  passenger_file_descriptor_log_file /var/log/nginx/passenger_file_descriptor.log; # üìù

  # ü§ê Gzip Settings
  #
  gzip              on;    # Use `curl -H "Accept-Encoding: gzip" -I https://example.com` to check the `Content-Encoding: gzip` response header.
  gzip_vary         on;    # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ Vary: Accept-Encoding –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–∫—Å–∏.
  gzip_comp_level   9;     # –£—Ä–æ–≤–µ–Ω—å —Å–∂–∞—Ç–∏—è –æ—Ç 1 (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Å–∂–∞—Ç–∏–µ) –¥–æ 9 (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ).
  gzip_min_length   512;   # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –¥–ª—è —Å–∂–∞—Ç–∏—è.
  gzip_buffers      8 64k; # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—É—Ñ–µ—Ä–æ–≤ –∏ —Ä–∞–∑–º–µ—Ä –∫–∞–∂–¥–æ–≥–æ –∏–∑ –Ω–∏—Ö. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é Nginx –æ–±—ã—á–Ω–æ –≤—ã–¥–µ–ª—è–µ—Ç 4 –±—É—Ñ–µ—Ä–∞ –ø–æ 16 KB.
  gzip_types        text/plain text/css text/javascript text/js text/xml application/json application/javascript application/x-javascript application/xml application/xml+rss application/x-font-ttf image/svg+xml font/opentype; # It doesn't make sense: application/octet-stream, image/gif, image/png, font/woff2, image/jpeg
  gzip_proxied      any;            # –°–∂–∏–º–∞—Ç—å –ª–∏ –æ—Ç–≤–µ—Ç—ã –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏—Ö Gzip.
  gzip_disable      "MSIE [1-6]\."; # –û—Ç–∫–ª—é—á–∏—Ç—å —Å–∂–∞—Ç–∏–µ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤.
  gzip_http_version 1.1;            # C–∂–∞—Ç–∏–µ Gzip —Ä–∞–∑—Ä–µ—à–µ–Ω–æ —Ç–∞–∫–∂–µ –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ HTTP/1.0, –Ω–æ —ç—Ç–æ –º–µ–Ω–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –≤–µ—Ä—Å–∏—è HTTP/1.0 –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –≤–∞–∂–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤–ª–∏—è—Ç—å –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

  # ‚òÅÔ∏è  Cloudflare (https://www.cloudflare.com/ips)
  #
  set_real_ip_from    173.245.48.0/20;
  set_real_ip_from    103.21.244.0/22;
  set_real_ip_from    103.22.200.0/22;
  set_real_ip_from    103.31.4.0/22;
  set_real_ip_from    141.101.64.0/18;
  set_real_ip_from    108.162.192.0/18;
  set_real_ip_from    190.93.240.0/20;
  set_real_ip_from    188.114.96.0/20;
  set_real_ip_from    197.234.240.0/22;
  set_real_ip_from    198.41.128.0/17;
  set_real_ip_from    162.158.0.0/15;
  set_real_ip_from    104.16.0.0/13;
  set_real_ip_from    104.24.0.0/14;
  set_real_ip_from    172.64.0.0/13;
  set_real_ip_from    131.0.72.0/22;
  set_real_ip_from    2400:cb00::/32;
  set_real_ip_from    2606:4700::/32;
  set_real_ip_from    2803:f800::/32;
  set_real_ip_from    2405:b500::/32;
  set_real_ip_from    2405:8100::/32;
  set_real_ip_from    2a06:98c0::/29;
  set_real_ip_from    2c0f:f248::/32;
  real_ip_header      CF-Connecting-IP;

  # ‚ìÇÔ∏è  Cache settings
  #
  proxy_cache_path /var/cache/nginx levels=2 keys_zone=cache:10m inactive=60m max_size=1024m; # –ü—É—Ç—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫—ç—à–∞:
  # - levels ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Ñ–∞–π–ª–æ–≤.
  # - keys_zone ‚Äî –∑–∞–¥–∞–µ—Ç –∏–º—è –∏ –æ–±—ä–µ–º –ø–∞–º—è—Ç–∏ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–ª—é—á–µ–π –∫—ç—à–∞.
  # - inactive ‚Äî –≤—Ä–µ–º—è, –≤ —Ç–µ—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç –≤ –∫—ç—à–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º, –µ—Å–ª–∏ –Ω–µ –±—ã–ª–æ –æ–±—Ä–∞—â–µ–Ω–∏–π.
  # - max_size ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫—ç—à–∞.
  proxy_cache_key "$host$request_uri $cookie_user"; # –ó–∞–¥–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è, –≤–∫–ª—é—á–∞—é—â–∏–π —Ö–æ—Å—Ç, URI –∏ –∑–Ω–∞—á–µ–Ω–∏–µ cookie $cookie_user.
  proxy_temp_path  /var/cache/nginx/temp; # –ü—É—Ç—å –∫ –≤—Ä–µ–º–µ–Ω–Ω–æ–º—É —Ö—Ä–∞–Ω–∏–ª–∏—â—É –¥–ª—è —Ñ–∞–π–ª–æ–≤, –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∏—Ö –≤ –∫—ç—à.
  # proxy_ignore_headers Expires Cache-Control; # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ Expires –∏ Cache-Control, —á—Ç–æ–±—ã —É–ø—Ä–∞–≤–ª—è—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞.
  proxy_cache_use_stale error timeout invalid_header http_502; # –ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –æ—à–∏–±–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, error, timeout, invalid_header, http_502) Nginx –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à—É—é –∫–æ–ø–∏—é –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤–º–µ—Å—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.
  proxy_cache_valid any 1d; # –ó–∞–¥–∞–µ—Ç –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤ (any) –Ω–∞ 1 –¥–µ–Ω—å.
  # Cache bypass
  map $http_cookie $no_cache { # –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π $no_cache –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ Cookie.
    default 0; # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫—ç—à –Ω–µ –æ–±—Ö–æ–¥–∏—Ç—Å—è.
    ~SESS 1; # –ï—Å–ª–∏ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ Cookie –µ—Å—Ç—å —Å–µ—Å—Å–∏—è (SESS), –∫—ç—à –æ–±—Ö–æ–¥–∏—Ç—Å—è.
    ~wordpress_logged_in 1; # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ª–æ–≥–∏–Ω–µ–Ω –≤ WordPress, –∫—ç—à —Ç–æ–∂–µ –æ–±—Ö–æ–¥–∏—Ç—Å—è.
  }
  # Cache status header
  map $upstream_cache_status $cache_status {
    ""      "N/A";
    default $upstream_cache_status;
  }
  more_set_headers "X-Cache-Status: $cache_status"; # Possible vsalues: `HIT`, `MISS`, `EXPIRED`, `STALE`, `UPDATING`, –∏–ª–∏ `MODIFIED`
  # File cache settings
  open_file_cache          max=10000 inactive=30s; # –í–∫–ª—é—á–∞–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏ —É–∫–∞–∑—ã–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ –≤ –∫—ç—à–µ.
  open_file_cache_valid    60s; # –í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π ‚Äî 60 —Å–µ–∫—É–Ω–¥.
  open_file_cache_min_uses 2; # –§–∞–π–ª –±—É–¥–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –±—ã–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∫–∞–∫ –º–∏–Ω–∏–º—É–º –¥–≤–∞–∂–¥—ã.
  open_file_cache_errors   off; # –û—Ç–∫–ª—é—á–∞–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ–∞–π–ª–æ–≤.
  #
  # Also: https://docs.nginx.com/nginx/admin-guide/content-cache/content-caching/

  # üö¶ Rate limiting
  #
  limit_req_zone $binary_remote_addr zone=antibot:10m rate=10r/s;

  # üì¶ Variables
  #
  include /etc/nginx/variables;

  # üè¥ Virtual Host Configs
  #
  include /etc/nginx/conf.d/*.conf;
  include /etc/nginx/sites-enabled/*;
}


#mail {
#	# See sample authentication script at:
#	# http://wiki.nginx.org/ImapAuthenticateWithApachePhpScript
#
#	# auth_http localhost/auth.php;
#	# pop3_capabilities "TOP" "USER";
#	# imap_capabilities "IMAP4rev1" "UIDPLUS";
#
#	server {
#		listen     localhost:110;
#		protocol   pop3;
#		proxy      on;
#	}
#
#	server {
#		listen     localhost:143;
#		protocol   imap;
#		proxy      on;
#	}
#}
